import{e as I,r as n,b as _,u as k,aw as F,j as s,C as M,c as u,B as w,D as G,E as B,F as D,aY as y,aZ as z,I as O,aQ as m}from"./index-DdC0FHAS.js";import{u as R}from"./index-DmNmbST7.js";const Q=()=>{const{id:l}=I(),[a,b]=n.useState(null),[r,p]=n.useState([]),{access:c,user:x}=_(e=>e.auth),[f,C]=n.useState(!1),{friends_list:j}=_(e=>e.profile),g=k(),{isOpen:N,onOpen:A,onOpenChange:i}=R(),[v,S]=n.useState([]);n.useEffect(()=>{if(a){const e=new Set(a.users.map(t=>t.id));S(j.filter(t=>!e.has(t.user_id)))}},[j,a]);const h=()=>{m.get(`http://localhost/api/chat/group-chats/${l}/`,{headers:{Authorization:`Bearer ${c}`}}).then(e=>{b(e.data.group_chat);const t=e.data.group_chat.admins.some(d=>d.user.id===x.pk);C(t)}).catch(e=>console.error("Error fetching group chat:",e))};n.useEffect(()=>{h(),g(F())},[l,c,g]);const $=()=>{var t,d;console.log((t=r==null?void 0:r.target)==null?void 0:t.value,"newMembers");const e=(d=r==null?void 0:r.target)==null?void 0:d.value.split(",").map(o=>o.trim()).map(o=>parseInt(o));console.log(e,"userIds"),m.post(`http://localhost/api/chat/group-chats/${l}/add-member/`,{user_ids:e},{headers:{Authorization:`Bearer ${c}`}}).then(o=>{h(),p([]),i()}).catch(o=>console.error("Error adding members:",o))},E=e=>{m.post(`http://localhost/api/chat/group-chats/${l}/remove-member/`,{user_id:e},{headers:{Authorization:`Bearer ${c}`}}).then(t=>{h()}).catch(t=>console.error("Error removing member:",t))};return s.jsxs(M,{children:[s.jsx("h1",{className:"text-lg font-bold",children:"Group Settings"}),a?s.jsxs("div",{children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Group Name:"})," ",a.name]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Description:"})," ",a.description]}),s.jsx("h2",{className:"mt-4 text-md font-bold",children:"Members"}),s.jsx("ul",{className:"list-disc pl-5",children:a.users.map(e=>s.jsxs("li",{className:"flex justify-between items-center gap-2 mb-2",children:[s.jsx("span",{children:e.username}),f&&e.id!==x.pk&&s.jsx("button",{onClick:()=>E(e.id),className:"btn-custom-red",children:"Remove"})]},e.id))}),f&&s.jsxs("div",{className:"mt-4",children:[s.jsx(u,{onClick:A,className:"btn-custom-yellow",children:"Add New Members"}),s.jsx(w,{isOpen:N,onOpenChange:i,children:s.jsxs(G,{children:[s.jsx(B,{children:s.jsx("h1",{className:"text-2xl font-bold",children:"Add New Members"})}),s.jsx(D,{children:s.jsx(y,{label:"Select Friends",placeholder:"Choose friends to add",selectionMode:"multiple",onChange:e=>p(e),children:v.map(e=>s.jsx(z,{value:e,children:e.username},e.user_id))})}),s.jsxs(O,{children:[s.jsx(u,{onClick:i,children:"Cancel"}),s.jsx(u,{onClick:$,children:"Add Members"})]})]})})]})]}):s.jsx("p",{children:"Loading group settings..."})]})};export{Q as default};
